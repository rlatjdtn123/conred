<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
   
  
<mapper namespace="com.hk.conred.Reply">
	
	<select id="replyList" parameterType="Map" resultType="ReplyDto">
		SELECT cr.rn,cr.STORE_SEQ,REPLY_SEQ ,USER_ID  ,REPLY_CONTENT  ,REPLY_CLEAN ,REPLY_PRICE ,REPLY_SERVICE ,REPLY_ANSWER ,REPLY_READ ,REPLY_REGDATE ,REPLY_DELFLAG,cs.STORE_NAME 
		FROM (SELECT ROW_NUMBER()OVER(ORDER BY REPLY_REGDATE ) AS rn,STORE_SEQ,USER_ID ,REPLY_CONTENT ,REPLY_SEQ ,REPLY_CLEAN ,REPLY_PRICE ,REPLY_SERVICE ,REPLY_ANSWER ,REPLY_READ ,REPLY_REGDATE ,REPLY_DELFLAG
		FROM CON_REPLY WHERE USER_ID =#{user_id}) cr,(SELECT STORE_SEQ ,store_name FROM CON_STORE ) cs
		WHERE user_id=#{user_id} and CEIL(rn/5)=#{pnum} AND cr.store_seq=cs.store_seq
	</select>
	 
	<select id="replyListStore" parameterType="int" resultType="ReplyDto">
		<![CDATA[
			SELECT *
			FROM CON_REPLY 
			WHERE STORE_SEQ=${store_seq}
			ORDER BY REPLY_REGDATE DESC
		]]>
	</select> 
	
	<select id="replyAvgStore" parameterType="int" resultType="ReplyDto">
		<![CDATA[
			SELECT TRUNC(AVG(REPLY_CLEAN),1) AS clean_avg,
			TRUNC(AVG(REPLY_SERVICE ),1) AS service_avg,
			TRUNC(AVG(REPLY_PRICE),1) AS price_avg,
			TRUNC((AVG(REPLY_CLEAN)+AVG(REPLY_SERVICE)+AVG(REPLY_PRICE))/3,1) AS all_avg,
			COUNT(REPLY_CONTENT) AS reply_count ,
			COUNT(REPLY_ANSWER) AS answer_count
			FROM con_REPLY
			WHERE STORE_SEQ =#{store_seq}
		]]>
	</select>
	
	<select id="replyListStoreDetail" parameterType="Map" resultType="ReplyDto">
		SELECT rn,REPLY_SEQ ,USER_ID ,STORE_SEQ ,REPLY_CONTENT ,REPLY_CLEAN ,REPLY_PRICE ,REPLY_SERVICE ,REPLY_ANSWER ,REPLY_READ,REPLY_REGDATE ,REPLY_DELFLAG
		FROM 
			(SELECT ROW_NUMBER()over(ORDER BY REPLY_REGDATE ) AS rn,REPLY_SEQ ,USER_ID ,STORE_SEQ ,REPLY_CONTENT ,REPLY_CLEAN ,REPLY_PRICE ,REPLY_SERVICE ,REPLY_ANSWER ,REPLY_READ,REPLY_REGDATE ,REPLY_DELFLAG
			FROM CON_REPLY
			WHERE STORE_SEQ =#{store_seq})
		WHERE CEIL(rn/5)=#{pnum} 
	</select>
	
</mapper>
	 