<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
   
  
<mapper namespace="com.hk.conred.Reply">
	
	<select id="replyList" parameterType="Map" resultType="ReplyDto">
		SELECT  rn,REPLY_SEQ ,USER_ID ,STORE_SEQ ,REPLY_CONTENT  ,REPLY_CLEAN ,REPLY_PRICE ,REPLY_SERVICE ,REPLY_ANSWER ,REPLY_READ ,REPLY_REGDATE ,REPLY_DELFLAG 
		FROM
		    (SELECT  rownum AS rn, REPLY_SEQ ,USER_ID ,STORE_SEQ ,REPLY_CONTENT  ,REPLY_CLEAN ,REPLY_PRICE ,REPLY_SERVICE ,REPLY_ANSWER ,REPLY_READ ,REPLY_REGDATE ,REPLY_DELFLAG
		     FROM CON_REPLY)
		WHERE CEIL(rn/5)=#{pnum} AND USER_ID =#{user_id}
	</select>
	
	<select id="replyListStore" parameterType="int" resultType="ReplyDto">
		<![CDATA[
			SELECT *
			FROM CON_REPLY
			WHERE STORE_SEQ=${store_seq}
			ORDER BY REPLY_REGDATE DESC
		]]>
	</select>
	
	<select id="replyAvgStore" parameterType="int" resultType="ReplyDto">
		<![CDATA[
			SELECT TRUNC(AVG(REPLY_CLEAN),1) AS clean_avg,
			TRUNC(AVG(REPLY_SERVICE ),1) AS service_avg,
			TRUNC(AVG(REPLY_PRICE),1) AS price_avg,
			TRUNC((AVG(REPLY_CLEAN)+AVG(REPLY_SERVICE)+AVG(REPLY_PRICE))/3,1) AS all_avg,
			COUNT(REPLY_CONTENT) AS reply_count ,
			COUNT(REPLY_ANSWER) AS answer_count
			FROM con_REPLY
			WHERE STORE_SEQ =#{store_seq}
		]]>
	</select>
	
	<select id="replyListStoreDetail" parameterType="Map" resultType="ReplyDto">
		SELECT  rownum , REPLY_SEQ ,USER_ID ,STORE_SEQ ,REPLY_CONTENT  ,REPLY_CLEAN ,REPLY_PRICE ,REPLY_SERVICE ,REPLY_ANSWER ,REPLY_READ ,REPLY_REGDATE ,REPLY_DELFLAG
		FROM CON_REPLY 
		WHERE CEIL(ROWNUM/5)=#{pnum} AND STORE_SEQ =#{store_seq}
		ORDER BY REPLY_REGDATE DESC
	</select>
	
</mapper>
	 